<!DOCTYPE html>
<html>
    <head>
        <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no">
        <link rel="stylesheet" href="{{ url_for('static', filename='main.css') }}" />
        <link rel="stylesheet" href="http://cdn.leafletjs.com/leaflet-0.7.3/leaflet.css" />
    </head>
    <body>
        <div id="map"></div>


        <script type="text/javascript" src="http://cdn.leafletjs.com/leaflet-0.7.3/leaflet.js"></script>
        <script type="text/javascript" src="http://maps.stamen.com/js/tile.stamen.js?v1.3.0"></script>
        <script>
            var map = L.map('map').setView([35.1213616,-89.939336], 15);
            var stamen = new L.StamenTileLayer("terrain");
            map.addLayer(stamen);

            // Initialize the searchCircle and PlacesGroup layers so that they
            // can be removed/updated at each call of getPlaces
            var searchCircle = L.circle([0,0], 0.5, {
                    color: '#D4D419',
                    fillColor: '#D4D419',
                    fillOpacity: 0.0
            }).addTo(map);
            var placesGroup = L.layerGroup().addTo(map);

 
            // Attach the map click event handler to our getPlaces function
            map.on('click', function(e) {
                    getPlaces(e.latlng);
            });

            // Create a function that passes a REST request to our flask within() route
            function getPlaces(latlng) {
                url = "/within?lat=" + latlng.lat + "&lng=" + latlng.lng;

                map.removeLayer(searchCircle);
                searchCircle = L.circle([latlng.lat, latlng.lng], 500, {
                        color: '#D4D419',
                        fillColor: '#D4D419',
                        fillOpacity: 0.4
                        }).addTo(map);

                // send the REST request to the within() function
                var request = null;
                request = new XMLHttpRequest();

                // Create our function to parse the JSON in the 
                // onreadystatechange of the request so that it can
                // handle requests asynchronously
                request.onreadystatechange = function() {
                    if (request.readyState == 4 && request.status == 200)
                    {
                        console.log(JSON.parse(request.responseText));
                    }
                }

                request.open("GET", url, true);
                request.send(null);
            }
        </script>
    </body>
</html>

